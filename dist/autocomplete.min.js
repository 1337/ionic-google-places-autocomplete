"use strict";angular.module("google.places",[]).factory("googlePlacesApi",["$window",function(a){if(!a.google)throw"Global `google` var missing. Did you forget to include the places API script?";return a.google}]).directive("gPlacesAutocomplete",["$parse","$compile","$timeout","googlePlacesApi",function(a,b,c,d){return{restrict:"A",require:"^ngModel",scope:{model:"=ngModel",options:"=?",forceSelection:"=?"},controller:["$scope",function(){}],link:function(a,c,e,f){function g(){c.bind("keydown",j),c.bind("blur",k),a.$watch("selected",l)}function h(){var d=angular.element("<div g-places-autocomplete-drawer></div>");d.attr({input:"input",query:"query",predictions:"predictions",active:"active",selected:"selected"});var e=b(d)(a);c.after(e)}function i(){f.$parsers.push(m),f.$formatters.push(n),f.$render=o}function j(b){0!==a.predictions.length&&-1!==_.indexOf(r,b.which)&&(b.preventDefault(),b.which===q.down?(a.active=(a.active+1)%a.predictions.length,a.$digest()):b.which===q.up?(a.active=(a.active?a.active:a.predictions.length)-1,a.$digest()):13===b.which||9===b.which?(a.forceSelection&&(a.active=-1===a.active?0:a.active),a.$apply(function(){a.selected=a.active,-1===a.selected&&p()})):27===b.which&&(b.stopPropagation(),p(),a.$digest()))}function k(){0!==a.predictions.length&&(a.forceSelection&&(a.selected=-1===a.selected?0:a.selected),a.$digest(),a.$apply(function(){-1===a.selected&&p()}))}function l(){var b;b=a.predictions[a.selected],b&&(t.getDetails({reference:b.reference},function(b,c){c==d.maps.places.PlacesServiceStatus.OK&&a.$apply(function(){a.model=b})}),p())}function m(b){var c;return b&&_.isString(b)?(a.query=b,c=angular.extend({input:b},a.options),s.getPlacePredictions(c,function(b,c){a.$apply(function(){p(),c==d.maps.places.PlacesServiceStatus.OK&&a.predictions.push.apply(a.predictions,b)})}),b):b}function n(a){var b="";return _.isString(a)?b=a:_.isObject(a)&&(_.has(a,"formatted_address")?b=a.formatted_address:_.has(a,"name")&&(b=a.name)),b}function o(){return c.val(f.$viewValue)}function p(){a.active=-1,a.selected=-1,a.predictions.length=0}var q={tab:9,enter:13,esc:27,up:38,down:40},r=[q.tab,q.enter,q.esc,q.up,q.down],s=new d.maps.places.AutocompleteService,t=new d.maps.places.PlacesService(c[0]);!function(){a.query="",a.predictions=[],a.input=c,a.options=a.options||{},h(),g(),i()}()}}}]).directive("gPlacesAutocompleteDrawer",["$window","$document",function(a,b){var c=['<div class="pac-container" ng-if="isOpen()" ng-style="{top: position.top+\'px\', left: position.left+\'px\', width: position.width+\'px\'}" style="display: block;" role="listbox" aria-hidden="{{!isOpen()}}">','  <div class="pac-item" g-places-autocomplete-prediction index="$index" prediction="prediction" query="query"','       ng-repeat="prediction in predictions track by $index" ng-class="{\'pac-item-selected\': isActive($index) }"','       ng-mouseenter="selectActive($index)" ng-click="selectPrediction($index)" role="option" id="{{prediction.id}}">',"  </div>","</div>"];return{restrict:"A",scope:{input:"=",query:"=",predictions:"=",active:"=",selected:"="},template:c.join(""),link:function(c){function d(c){var d=c[0],e=b[0].documentElement,f=a.pageXOffset||e.scrollLeft,g=a.pageYOffset||e.scrollTop,h=d.getBoundingClientRect();return{width:h.width,height:h.height,top:c.prop("offsetTop")+h.height+g,left:c.prop("offsetLeft")+f}}c.isOpen=function(){return c.predictions.length>0},c.isActive=function(a){return c.active===a},c.selectActive=function(a){c.active=a},c.selectPrediction=function(a){c.selected=a},c.$watch("predictions",function(){c.position=d(c.input)})}}}]).directive("gPlacesAutocompletePrediction",[function(){var a=['<span class="pac-icon pac-icon-marker"></span>','<span class="pac-item-query">','  <span class="pac-matched">{{prediction | matchedQuery}}</span>{{prediction | unmatchedQuery}}',"</span>",'<span ng-repeat="term in prediction.terms | unmatched:prediction">{{term.value | trailingComma:!$last}}&nbsp;</span>'];return{restrict:"A",scope:{index:"=",prediction:"=",query:"="},template:a.join("")}}]).filter("matchedQuery",[function(){return function(a){var b,c="";return a.matched_substrings.length>0&&a.terms.length>0&&(b=a.matched_substrings[0],c=a.terms[0].value.substr(b.offset,b.length)),c}}]).filter("unmatchedQuery",[function(){return function(a){var b,c="";return a.matched_substrings.length>0&&a.terms.length>0&&(b=a.matched_substrings[0],c=a.terms[0].value.substr(b.offset+b.length)),c}}]).filter("unmatched",[function(){return function(a,b){var c,d,e=[];for(c=0;c<a.length;c++)d=a[c],b.matched_substrings.length>0&&d.offset>b.matched_substrings[0].length&&e.push(d);return e}}]).filter("trailingComma",[function(){return function(a,b){return b?a+",":a}}]);